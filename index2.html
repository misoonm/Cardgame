<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة البطاقات</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            padding: 20px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            background-color: #4CAF50;
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .total-points {
            font-size: 18px;
            font-weight: bold;
        }
        
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .level-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .level-card:hover {
            transform: translateY(-5px);
        }
        
        .level-card.locked {
            background-color: #e0e0e0;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .level-card.completed {
            background-color: #C8E6C9;
        }
        
        .game-screen {
            display: none;
        }
        
        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        
        .app-cards, .player-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .card {
            width: 100px;
            height: 150px;
            perspective: 1000px;
            cursor: pointer;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .card-front {
            background-color: #bbdefb;
            color: #1976d2;
            transform: rotateY(180deg);
        }
        
        .card-back {
            background-color: #4CAF50;
            color: white;
        }
        
        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 1000;
        }
        
        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
        }
        
        .btn:hover {
            background-color: #45a049;
        }
        
        @media (max-width: 480px) {
            .levels-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .card {
                width: 80px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- شاشة المستويات -->
        <div id="levels-screen">
            <header>
                <h1>لعبة البطاقات</h1>
                <div class="total-points">إجمالي النقاط: <span id="total-points">0</span></div>
            </header>
            
            <div class="levels-grid" id="levels-container">
                <!-- سيتم ملء المستويات ديناميكيًا -->
            </div>
        </div>
        
        <!-- شاشة اللعبة -->
        <div id="game-screen" class="game-screen">
            <header>
                <h1>المستوى <span id="current-level">1</span></h1>
                <div>النقاط: <span id="level-points">0</span>/3</div>
            </header>
            
            <div class="cards-container">
                <h2>بطاقات التطبيق</h2>
                <div class="app-cards" id="app-cards">
                    <!-- سيتم ملء بطاقات التطبيق ديناميكيًا -->
                </div>
                
                <h2>بطاقات اللاعب</h2>
                <div class="player-cards" id="player-cards">
                    <!-- سيتم ملء بطاقات اللاعب ديناميكيًا -->
                </div>
            </div>
            
            <button class="btn" id="back-btn">العودة إلى المستويات</button>
        </div>
        
        <!-- رسائل التطبيق -->
        <div class="message" id="message">
            <p id="message-text"></p>
            <button class="btn" id="message-btn">موافق</button>
        </div>
    </div>

    <script>
        // تعريف المتغيرات العامة
        let db;
        let currentLevel = 1;
        let levelPoints = 0;
        let totalPoints = 0;
        let selectedCard = null;
        
        // بيانات المستويات والبطاقات (سيتم استبدالها بصور حقيقية)
        const levelsData = [];
        for (let i = 1; i <= 23; i++) {
            levelsData.push({
                id: i,
                cards: [
                    { id: `${i}-1`, type: 'puzzle', image: `img/puzzle-${i}-1.jpg` },
                    { id: `${i}-2`, type: 'puzzle', image: `img/puzzle-${i}-2.jpg` },
                    { id: `${i}-3`, type: 'puzzle', image: `img/puzzle-${i}-3.jpg` },
                    { id: `${i}-1`, type: 'solution', image: `img/solution-${i}-1.jpg` },
                    { id: `${i}-2`, type: 'solution', image: `img/solution-${i}-2.jpg` },
                    { id: `${i}-3`, type: 'solution', image: `img/solution-${i}-3.jpg` }
                ]
            });
        }
        
        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', initApp);
        
        function initApp() {
            initializeDB();
            setupEventListeners();
        }
        
        // تهيئة قاعدة البيانات IndexedDB
        function initializeDB() {
            const request = indexedDB.open('CardGameDB', 1);
            
            request.onerror = (event) => {
                console.error('فشل في فتح قاعدة البيانات', event);
            };
            
            request.onsuccess = (event) => {
                db = event.target.result;
                loadGameData();
            };
            
            request.onupgradeneeded = (event) => {
                db = event.target.result;
                
                // إنشاء مخزن للمستويات إذا لم يكن موجودًا
                if (!db.objectStoreNames.contains('levels')) {
                    const levelsStore = db.createObjectStore('levels', { keyPath: 'id' });
                    levelsStore.createIndex('completed', 'completed', { unique: false });
                    levelsStore.createIndex('points', 'points', { unique: false });
                }
                
                // إنشاء مخزن للإحصائيات إذا لم يكن موجودًا
                if (!db.objectStoreNames.contains('stats')) {
                    const statsStore = db.createObjectStore('stats', { keyPath: 'id' });
                }
            };
        }
        
        // تحميل بيانات اللعبة
        function loadGameData() {
            // تحميل إحصائيات اللعبة
            const transaction = db.transaction(['stats'], 'readonly');
            const statsStore = transaction.objectStore('stats');
            const request = statsStore.get('totalPoints');
            
            request.onsuccess = (event) => {
                if (request.result) {
                    totalPoints = request.result.value;
                    document.getElementById('total-points').textContent = totalPoints;
                }
            };
            
            // تحميل بيانات المستويات
            loadLevels();
        }
        
        // تحميل و عرض المستويات
        function loadLevels() {
            const levelsContainer = document.getElementById('levels-container');
            levelsContainer.innerHTML = '';
            
            const transaction = db.transaction(['levels'], 'readonly');
            const levelsStore = transaction.objectStore('levels');
            
            for (let i = 1; i <= 23; i++) {
                const levelCard = document.createElement('div');
                levelCard.className = 'level-card';
                levelCard.dataset.level = i;
                
                const levelText = document.createElement('h3');
                levelText.textContent = `المستوى ${i}`;
                levelCard.appendChild(levelText);
                
                // التحقق من حالة المستوى
                const request = levelsStore.get(i);
                
                request.onsuccess = (event) => {
                    if (request.result) {
                        if (request.result.completed) {
                            levelCard.classList.add('completed');
                            const pointsText = document.createElement('p');
                            pointsText.textContent = `النقاط: ${request.result.points}/3`;
                            levelCard.appendChild(pointsText);
                        }
                    } else if (i > 1) {
                        // قفل المستوى إذا لم يتم إكمال المستوى السابق
                        const prevRequest = levelsStore.get(i-1);
                        
                        prevRequest.onsuccess = (e) => {
                            if (!prevRequest.result || !prevRequest.result.completed) {
                                levelCard.classList.add('locked');
                            }
                        };
                    }
                };
                
                levelCard.addEventListener('click', () => {
                    if (!levelCard.classList.contains('locked')) {
                        startLevel(i);
                    }
                });
                
                levelsContainer.appendChild(levelCard);
            }
        }
        
        // بدء مستوى جديد
        function startLevel(level) {
            currentLevel = level;
            levelPoints = 0;
            
            // تحديث واجهة المستخدم
            document.getElementById('levels-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            document.getElementById('current-level').textContent = level;
            document.getElementById('level-points').textContent = '0';
            
            // إنشاء البطاقات
            createCards(level);
        }
        
        // إنشاء بطاقات المستوى
        function createCards(level) {
            const appCardsContainer = document.getElementById('app-cards');
            const playerCardsContainer = document.getElementById('player-cards');
            
            appCardsContainer.innerHTML = '';
            playerCardsContainer.innerHTML = '';
            
            const levelData = levelsData[level - 1];
            
            // فصل البطاقات إلى ألغاز وحلول
            const puzzleCards = levelData.cards.filter(card => card.type === 'puzzle');
            const solutionCards = levelData.cards.filter(card => card.type === 'solution');
            
            // خلط بطاقات الحل
            shuffleArray(solutionCards);
            
            // إنشاء بطاقات التطبيق (الألغاز)
            puzzleCards.forEach(card => {
                const cardElement = createCardElement(card, false);
                appCardsContainer.appendChild(cardElement);
            });
            
            // إنشاء بطاقات اللاعب (الحلول)
            solutionCards.forEach(card => {
                const cardElement = createCardElement(card, true);
                playerCardsContainer.appendChild(cardElement);
            });
        }
        
        // إنشاء عنصر بطاقة
        function createCardElement(cardData, isPlayerCard) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.id = cardData.id;
            
            const cardInner = document.createElement('div');
            cardInner.className = 'card-inner';
            
            const cardFront = document.createElement('div');
            cardFront.className = 'card-front';
            
            // في التطبيق الحقيقي، استخدم عنصر img بدلاً من النص
            const cardImage = document.createElement('img');
            cardImage.src = cardData.image;
            cardImage.alt = `بطاقة ${cardData.type === 'puzzle' ? 'لغز' : 'حل'}`;
            cardImage.style.width = '100%';
            cardImage.style.height = '100%';
            cardImage.style.objectFit = 'cover';
            cardImage.style.borderRadius = '10px';
            cardFront.appendChild(cardImage);
            
            const cardBack = document.createElement('div');
            cardBack.className = 'card-back';
            cardBack.textContent = '؟';
            
            cardInner.appendChild(cardFront);
            cardInner.appendChild(cardBack);
            card.appendChild(cardInner);
            
            if (isPlayerCard) {
                card.addEventListener('click', () => selectCard(card));
            } else {
                card.addEventListener('click', () => showPuzzleCard(card));
            }
            
            return card;
        }
        
        // عرض بطاقة اللغز
        function showPuzzleCard(card) {
            if (selectedCard) return; // منع النقر إذا كان هناك بطاقة مختارة بالفعل
            
            card.classList.add('flipped');
            selectedCard = card;
            
            // إعادة البطاقة إلى وضعها الأصلي بعد 3 ثوانٍ
            setTimeout(() => {
                if (card.classList.contains('flipped')) {
                    card.classList.remove('flipped');
                    selectedCard = null;
                }
            }, 3000);
        }
        
        // اختيار بطاقة الحل
        function selectCard(card) {
            if (!selectedCard) {
                showMessage('الرجاء النقر على إحدى بطاقات اللغز أولاً');
                return;
            }
            
            // التحقق إذا كان الحل صحيحًا
            if (selectedCard.dataset.id === card.dataset.id) {
                // الإجابة صحيحة
                card.classList.add('flipped');
                selectedCard.style.visibility = 'hidden';
                selectedCard = null;
                
                // زيادة النقاط
                levelPoints++;
                document.getElementById('level-points').textContent = levelPoints;
                
                if (levelPoints === 3) {
                    // المستوى مكتمل
                    completeLevel();
                } else {
                    showMessage('ممتاز! لقد كسبت نقطة');
                }
            } else {
                // الإجابة خاطئة
                showMessage('إجابة خاطئة، حاول مرة أخرى');
                selectedCard.classList.remove('flipped');
                selectedCard = null;
            }
        }
        
        // إكمال المستوى
        function completeLevel() {
            // حفظ النقاط في قاعدة البيانات
            const transaction = db.transaction(['levels', 'stats'], 'readwrite');
            
            // تحديث بيانات المستوى
            const levelsStore = transaction.objectStore('levels');
            levelsStore.put({
                id: currentLevel,
                completed: true,
                points: levelPoints
            });
            
            // تحديث النقاط الإجمالية
            totalPoints += levelPoints;
            const statsStore = transaction.objectStore('stats');
            statsStore.put({
                id: 'totalPoints',
                value: totalPoints
            });
            
            transaction.oncomplete = () => {
                showMessage(`تهانينا! لقد أكملت المستوى ${currentLevel}`, true);
                document.getElementById('total-points').textContent = totalPoints;
            };
        }
        
        // عرض رسالة
        function showMessage(text, isLevelComplete = false) {
            const message = document.getElementById('message');
            const messageText = document.getElementById('message-text');
            const messageBtn = document.getElementById('message-btn');
            
            messageText.textContent = text;
            message.style.display = 'block';
            
            messageBtn.onclick = () => {
                message.style.display = 'none';
                
                if (isLevelComplete) {
                    // العودة إلى شاشة المستويات بعد إكمال المستوى
                    document.getElementById('game-screen').style.display = 'none';
                    document.getElementById('levels-screen').style.display = 'block';
                    loadLevels();
                }
            };
        }
        
        // تهيئة مستمعي الأحداث
        function setupEventListeners() {
            document.getElementById('back-btn').addEventListener('click', () => {
                document.getElementById('game-screen').style.display = 'none';
                document.getElementById('levels-screen').style.display = 'block';
            });
        }
        
        // دالة لخلط المصفوفة (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
